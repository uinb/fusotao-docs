# Public Rest API

## General API Information

- The base endpoints are two: 
   - **TEST:** **```https://test-api.fxdx.finance```** 
   - **PRD:** **```https://prd-api.fxdx.finance```**
- All endpoints return either JSON object or array.
- Data is returned in ascending order. Oldest first, newest last.

### HTTP Return Codes
|Code| Description|
|--- | ---|
|200|Sucess|
|1|Illegal order type|
|2|Authentication failed|
|3|Insufficient balance|
|4|Access denied|
|5|Incompatible request|
|6|OTC not supported|
|7|Account not found|
|8|Wrong account type|
|9|Account not found or lack of balance |
|10|Order not found|
|11|Illegal order status|
|12|Retrieving account failed|
|13|Incompatible request|
|14|System error|
|15|Symbol closed|
|16|Market order disabled|
|17|Illegal number scale|
|18|Quantity error|
|19|Authentication failed|
|20|Illegal account type|
|21|Transfer failed|
|22|Number scale out of range|
|23|Maximum request limit exceed|
|24|Illegal transfer quantity|
|25|Authentication failed|
|26|Withdraw failed|
|27|Illegal currency|
|28|Request denied|
|29|Withdraw temporarily closed|
|30|Retrieving wallet address failed|
|31|Illegal withdraw quantity|
|32|Illegal locking date|
|33|Illegal parameters|
|34|Illegal address format|
|35|Number scale out of range|
|36|Subscription closed|
|37|Redeem closed|
|38|Invalid subscription|
|39|Url error|
|40|Share ongoin|
|41|Share seq exists|
|42|Found not subscription|
|43|Found not exists|
|44|Network error|
|45|Wrong data format|
|46|Wrong http method|
|47|Insufficient risk bearing capacity|
|48|System insufficient balance|
|49|Subscribe limit error|
|50|Price exceed increase or decrease|
|51|Have no deposit in 30 days|
|52|Had siginined today|
|53|System busy|
|54|Min amount error|
|55|Scale error|

## General Info on Limits

### IP Limits
We blocked ip from mainland China.

---
## Endpoint security 
- Each endpoint has a security type that determines how you will interact with it. This is stated next to the NAME of the endpoint.
- If no security type is stated, assume the security type is NONE.
- Secret-keys passed into the Rest API via the **`X-Signature`** header.
- Address and timestamp also neeaed via the **`X-Address`** and **`X-Timestamp`**.
- **`TRADE`** and **`USER_DATA`** endpoints are **`SIGNED`** endpoints.

|SecurityType| Description|
|---|---|
|USER_DATA|Endpoint requires sending a valid signature. | 
|TRADE |Endpoint requires sending a valid signature. |
|MARKET_DATA|Endpoint can be accessed freely.|


### **Role**
|Role|Description|
|---|---|
|maker| The endpoints start with maker should be used with the maker address, and the token should be generated by FXDX official.|
|api|The endpoins start with api should be used with `non-maker` address, the token should be generated by following steps.|

- Maker URI
```sh
Method /maker/xxxx
```

- Non-maker URI
```sh
Method /api/xxxx
```

### SIGNED Endpoint security
TRADE and USER_DATA
- The api key negotiation is divided into three steps.
- SIGNED endpoints require an additional parameter, signature, to be sent in **`X-Address`**, **`X-Signature`** ,**`X-Timestamp`** headers.
- Endpoints use **```HMAC SHA256```** signatures. The ```HMAC SHA256 ```signature is a keyed ```HMAC SHA256``` operation. Use your secretKey as the key and totalParams as the value for the HMAC operation.

##### Get nonce from the server.

- Get Nonce
```
POST /maker/nonce
```

**Request exmaple**

```sh
curl -X POST https://xxx.com/maker/nonce
```

##### Get Token from the server.
- Get Token by address and nonce.

```sh
POST /maker/token
```

> THe follow siganature should be signed with the private key of the pubkey.

**Request exmaple**
```sh
curl -X POST -H ’Content-Type: application/json‘ --data '{"nonce":"ccsfwgerwgserg", "pubkey":"5Gaigjeirgwoesrijhserihwerhrserhsbseriibsegrserg", "signature":"gergsefbdfshrjherfdhdfchfsefdherhedhbfgdfwehrbw4rhwrhw4h5wy4rgsddfhertrdrfgdf"}' https://xxx.com/maker/token
```

##### How to sign your request.

- Sign your request

```sh
 hmacsha256(token+","+timestamp+","+uri+","+ request body)
```

**Request exmaple**

```sh
POST http://xxx.com/maker/order
header:
    X-Signature: hmacsha256(secretKey,timestamp,/maker/order,122.2,100.11,taousdt,1)
    X-Address: xxxxxxxx
    X-Rimestamp: 1522233333333
body:
    {
        "type": 1,
        "symbol": "taousdt",
        "price": 100.11,
        "amount": 122.2
    }
```

**HTTP Request java code exmaple**

```java
    public static void main(String... args) {

        String secretKey = "fwjavssbiigredskjvn332ew";
        String address = "5GZJY2evJJ6GGeEMAdsf3rXyuZa7tXj5C9oopLvYnMnWaVub";
        Long time = System.currentMills()/1000;

        OkHttpClient client = new OkHttpClient();
        HashMap<String, Object> map = new HashMap<>();
        map.put("amount", 122.11);
        map.put("symbol", "taousdt");
        map.put("type", 1);
        map.put("price", 11.1);
        StringBuffer sb = new StringBuffer();
        List<String> keyList = new ArrayList<>();
        map.keySet().forEach(k -> {
            keyList.add(k);
        });
        Collections.sort(keyList);
        keyList.forEach(k -> {
            sb.append(map.get(k)).append(",");
        });
        String s = sb.toString().substring(0, sb.length() - 1);
        System.out.println(s);

        List<String> signContentList = new ArrayList<>();

        signContentList.add(secretKey);
        signContentList.add(time+"");
        signContentList.add("/maker/order");
        if(!StringUtils.isEmpty(s))  //it can be null, if request do not bring request body.
               signContentList.add(s);
        String signContent = String.join(",", signContentList);

        //get the signature
        String sign = "";
        try {
            sign = DigestUtil.hmcsha1(secretKey,signContent);
        } catch (Exception e) {
            e.printStackTrace();
        }

        RequestBody body = RequestBody.create(MediaType.parse("application/json"), JSONObject.toJSONString(map));

        String url = "http://xxx.com/maker/order";
        Request request = new Request.Builder().url(url)
                .addHeader("X-Signature", sign)
                .addHeader("X-Address", accessKey)
                .addHeader("X-Timestamp", time)
                .post(body)
                .build();
        try {
            Response response = client.newCall(request).execute();
            System.out.println(response.body().string());
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

```

## Public API Endpoints

### Terminology
- **base asset** refers to the asset that is the quantity of a symbol. For the symbol BTCUSDT, BTC would be the base asset.
- **quote asset** refers to the asset that is the price of a symbol. For the symbol BTCUSDT, USDT would be the quote asset.

#### ENUM definitions

##### **Order status(status)**
|Status| Description|
|---   | ---        |
|0|PLACED |
|1|CANCELED|
|2|FILLED|
|3|PARTIAL_FILLED|
|4|CONDITIONAL_CANCELED|
|900|REJECT|


##### **Order type(type)**
We only open the limit order function currently.

|Type|Description|
|---|---|
|0|ask|
|1|bid|

##### **Kline scale**
|Scale|Description|
|---|---|
|MINUTE| 1 minutes level|
|MINUTE_5|5 minutes level|
|MINUTE_15|15 minutes level|
|MINUTE_30|30 minutes level|
|HOUR|1 hour level|
|HOUR_4|4 hour level|
|DAY|1 day level|
|WEEK|1 week level|

---
## Market Data endpoints

### Order book
```
GET /maker/depth/{symbol}
```

**Parameters:**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|symbol| string|YES| |


**Request exmaple**

```sh
curl -X GET https://xxx.com/maker/depth/taousdt 
```

**Response body**
```js
{
   "code":200,
   "data":{
      "depth":32,
      "bids":[
         [
            1,   
            2,
            2
         ],
         [
            0.9,
            2,
            4
         ]
      ],
      "asks":[
         "...."
      ]
   }
}
```

### Kline/Candlestick data
```
GET /maker/kline/{symbol}/{scale}
```
**Parameters:**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|type|enum|YES| order type: ask(0) or bid(1)|
|symbol| string|YES| |
|scale|enum|YES| |

**Request exmaple**
```sh
curl -X GET https://xxx.com/maker/kline/taousdt/MINUTE_5 
```

**Response body**
```js
  {
    "code": 200,
    "data":[
        {
            "id": 1603030303 //unix timestamp，
            "open": 11.1
            "close":1
            "high":1
            "low":0.1
            "vol":100
        }
        .......
    ]
  }
```

### Query symbols
```
GET /maker/symbols
```

**Request exmaple**
```sh
curl -X GET https://xxx.com/maker/symbols
```

**Response body**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|base|int|YES| base currency id |
|quote|int|YES| quote currency id|
|base_name|string|YES| base currency name |
|quote_name|string|YES| quote currency name|
|base_scale|int|YES| |
|quote_scale|int|YES| |
|taker_fee|decimal|YES| |
|maker_fee|decimal|YES| |
|min_amount|decimal|YES| |
|min_vol|decimal|YES| |
|enable_market_order|bool|YES| |

---
## Account endpoints

### New order(TRADE)

We only open the limit order function currently.

```
POST /maker/order
```
Send in a new order or new orders

**Parameters:**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|type|enum|YES| order type: ask(0) or bid(1)|
|symbol| string|YES| |
|price|Bigdecimal|YES| |
|ammount|Bigdecimal|YES| |

**Request exmaple**

```sh
curl -X https://xxx.com/maker/order -H "Content-Type:application/json" -H "X-Address:xxxx" -H "X-Signature:xxx" -H "X-Timestamp:xxxxx" --data '{"type":1, "symbol":"taousdt", "price":1.22, "amount":11.2}'
```

**Request body**

- send a new single order.
```js
{
   "type":1,
   "symbol":"taousdt",
   "price":1.22,
   "amount":11.2
}
```

- send a batch of orders.
```js
[
   {
      "type":1,
      "symbol":"taousdt",
      "price":1.22,
      "amount":11.2
   },
   {
      "type":1,
      "symbol":"taousdt",
      "price":1.02,
      "amount":8.2
   }
]
```

**Response body**

- sucess
```js
  {
    "code": 200, 
    "data": "sgebweids"  // encoded order id
  }
```

- failure 
```js
  {
    "code": xx, 
    "msg: "xxxxxx"  //error message
  }
```

### Cancel order(TRADE)

```
DELETE /maker/order/{symbol}/{orderId}
```
Cancel an active order or a batch of orders.

**Parameters:**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|symbol| string|YES| |
|orderid|string|YES| |

**Request exmaple**

no requet body.

- cancel a single order.
```sh
curl -X DELETE https://xxx.com/maker/order/taousdt/U72Vs -H "X-Address:xxxx" -H "X-Signature:xxx" -H "X-Timestamp:xxxxx"'
```

- cancel a batch of orders.
```sh
curl -X DELETE https://xxx.com/maker/order/taousdt/U72Vs|U73dd|u77ds -H "X-Address:xxxx" -H "X-Signature:xxx" -H "X-Timestamp:xxxxx"
```

**Response body**

sucess
```js
  {
    "code": 200,
    "data": null
  }
```

### Query order(USER_DATA)

```
GET /maker/order/{symbol}/{orderId}
```

**Parameters:**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|symbol| string|YES| |
|orderid|string|YES| |

**Request exmaple**

no requet body.

- query a single order.
```sh
curl -X GET https://xxx.com/maker/order/taousdt/U72Vs -H "X-Address:xxxx" -H "X-Signature:xxx" -H "X-Timestamp:xxxxx" 
```

**Response body**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|symbol|string|YES| |
|order_id|string|YES| |
|order_type|enum|YES| |
|direction|enum|YES| |
|amount|Bigdecimal|YES| |
|price|Bigdecimal|YES| |
|filled_base|Bigdecimal|YES| |
|filled_quote|Bigdecimal|YES| |
|avg_price|Bigdecimal|YES| |
|status|Enum|YES| |
|trades|List|YES| |


**Detail for trade**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|base|string|YES| |
|ask_or_bid|string|YES| |
|price|enum|YES| |
|direction|enum|YES| |
|amount|Bigdecimal|YES| |
|quote_amount|Bigdecimal|YES| |
|quote_fee|Bigdecimal|YES| |
|base_fee|Bigdecimal|YES| |
|timestamp|Bigdecimal|YES| |


### Query order with page(USER_DATA)
```
GET /maker/orders/{symbol}/{page}/{size}/{pending}
```

**Parameters:**
|Name|Type|Mandatory|Description|
|---|---|---|---|
|symbol|string|YES| |
|page|int|YES| |
|size|enum|YES| |
|pending|bool|YES| |

**Request exmaple**

```sh
curl -X GET https://xxx.com/maker/orders/taousdt/0/100/true -H "X-Address:xxxx" -H "X-Signature:xxx" -H "X-Timestamp:xxxxx"
```

The response body of this endpoint is the same as the Query order endpoint.